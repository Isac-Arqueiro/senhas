<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="https://i.imgur.com/GMbtuHz.jpeg">
  <link rel="apple-touch-icon" href="https://i.imgur.com/GMbtuHz.jpeg">
  <meta name="theme-color" content="#1e90ff">
  <meta charset="UTF-8">
  <title>Painel de Senhas</title>
  <style>
body {
  font-family: 'Segoe UI', Arial, sans-serif;
  background: linear-gradient(135deg,#1e3c72,#2a5298);
  margin:0;padding:15px;color:#fff;
}
h1{text-align:center;margin-bottom:15px;font-size:1.6em;text-shadow:0 0 8px #000;}
.formulario{
  background:rgba(0,0,0,0.6);padding:15px;border-radius:10px;margin-bottom:15px;
  box-shadow:0 3px 8px rgba(0,0,0,0.4);
}
h2{margin-top:0;color:#ffcc00;text-align:center;font-size:1.1em;}
label{font-weight:bold;display:block;margin-top:8px;font-size:0.9em;}
input,select,textarea,button{
  margin-top:6px;padding:8px;width:100%;border-radius:6px;border:none;font-size:14px;box-sizing:border-box;
}
input,select,textarea{background:#f4f4f4;color:#333;}
button{background:#ffcc00;color:#333;font-weight:bold;cursor:pointer;transition:0.3s;margin-top:10px;}
button:hover{background:#ffdb4d;}
table{width:100%;border-collapse:collapse;margin-top:10px;font-size:12px;}
th,td{padding:6px;border:1px solid #444;text-align:center;}
th{background:#333;color:#ffcc00;}
td{background:rgba(255,255,255,0.1);}
td b{color:#00ffcc;}
.btn-mini{background:#00cc66;color:#fff;border:none;padding:4px 6px;border-radius:5px;cursor:pointer;font-size:11px;margin:1px;}
.btn-mini:hover{background:#00e676;}
.btn-del{background:#cc0000;}
.btn-del:hover{background:#ff3333;}
.btn-edit{background:#ff9900;}
.btn-edit:hover{background:#ffb84d;}
#pesquisa{margin-bottom:8px;padding:6px;width:100%;border-radius:6px;border:none;font-size:13px;background:#f4f4f4;color:#333;}

/* Mobile */
@media(max-width:600px){
  h1{font-size:1.4em;}
  table,thead,tbody,th,td,tr{display:block;}
  thead tr{display:none;}
  tr{margin-bottom:10px;border:1px solid #444;border-radius:6px;padding:5px;}
  td{border:none;padding:4px 0;text-align:right;position:relative;padding-left:50%;}
  td::before{content:attr(data-label);position:absolute;left:10px;width:45%;padding-left:5px;font-weight:bold;text-align:left;font-size:12px;}
}
  </style>
</head>
<body>
<h1>üîê Painel de Senhas</h1>

<div class="formulario">
  <h2>‚ûï Cadastrar / Editar Cliente</h2>
  <label>Nome:</label><input type="text" id="nome">
  <label>Observa√ß√£o:</label><textarea id="obs"></textarea>
  <label>Site:</label>
  <select id="site">
    <option value="A">Site A</option>
    <option value="B">Site B</option>
    <option value="C">Site C</option>
    <option value="D">Site D</option>
  </select>
  <input type="hidden" id="editIndex">
  <button onclick="salvarCliente()">Salvar</button>
</div>

<div class="formulario">
  <h2>üìã Clientes e Senhas</h2>
  <input type="text" id="pesquisa" placeholder="üîé Pesquisar..." onkeyup="filtrarTabela()">
  <table>
    <thead>
      <tr><th>Nome</th><th>Obs</th><th>Site</th><th>Senha</th><th>A√ß√µes</th></tr>
    </thead>
    <tbody id="lista"></tbody>
  </table>
</div>

<div class="formulario">
  <h2>üíæ Backup</h2>
  <button onclick="exportarDados()">‚¨áÔ∏è Exportar JSON</button>
  <input type="file" id="importarArquivo" accept=".json" onchange="importarDados(event)">
</div>

<script>
/* === SENHAS EMBUTIDAS === */
const todasSenhas = [
 "A002500","A002501","A0Q02502","A002D503","A0E02504","AB002505","A0T02506","A0J02507","A00T2508","A0G02509",
 "A0R02510","A0H02511","A0A02512","A0K02513","A0L02514","A0F02515","A0M02516","A0Z02517","A002518","A0R02519",
 "A0E02520","A0W02521","A0T02522","A0V02523","A0K02524","A0Y02525","A0R02526","A0Y02527","A0U02528","A0I02529",
 "A0P02530","A0A02531","A0S02532","A0D02533","A0F02534","A0G02535","A0H02536","A0J02537","A0K02538","A00L2539",
 "A0Z02540","A0X02541","A0C02542","A0V02543","A0B02544","A0N02545","A0M02546","A0N02547","A0B02548","A0V02549",
 "A0C02550","A0X02551","A0Z02552","A0A02553","A0S02554","A0D02555","A0F02556","A0G02557","A0H02558","A0J02559",
 "A0K02560","A0L02561","A0Q02562","A0W02563","A0E02564","A0R02565","A0T02566","A0Y02567","A0U02568","A0I02569",
 "A0O02570","A0P02571","A0A02572","A0S02573","A0D02574","A0F02575","A0G02576","A0H02577","A0J02578","A0K02579",
 "A0L02580","A002581","A002582","A002583","A002584","A0Z02585","A0X02586","A0C02587","A0V02588","A0B02589",
 "A0B02590","A0N02591","A0M02592","A0Q02593","A0W02594","A0E02595"
];

/* === Clientes e senhas usadas === */
let clientes = JSON.parse(localStorage.getItem("clientes") || "[]");
let raw = localStorage.getItem("senhasUsadas");
let senhasUsadas;
try {
  if (!raw) {
    senhasUsadas = [];
  } else {
    const parsed = JSON.parse(raw);
    if (Array.isArray(parsed)) {
      senhasUsadas = parsed;
    } else if (parsed && typeof parsed === "object") {
      senhasUsadas = Object.values(parsed).flat().filter(Boolean);
      senhasUsadas = [...new Set(senhasUsadas)];
    } else {
      senhasUsadas = [];
    }
  }
} catch { senhasUsadas = []; }

function salvarLocal(){
  localStorage.setItem("clientes", JSON.stringify(clientes));
  localStorage.setItem("senhasUsadas", JSON.stringify(senhasUsadas));
}

function proximaSenha(){
  for (let s of todasSenhas) {
    if (!senhasUsadas.includes(s)) {
      senhasUsadas.push(s);
      salvarLocal();
      return s;
    }
  }
  alert("‚ö†Ô∏è Todas as senhas foram usadas!");
  return null;
}

function salvarCliente(){
  const nome = document.getElementById("nome").value.trim();
  const obs = document.getElementById("obs").value.trim();
  const site = document.getElementById("site").value;
  const editIndex = document.getElementById("editIndex").value;

  if(!nome){ alert("Digite o nome!"); return; }

  if(editIndex){
    clientes[editIndex].nome = nome;
    clientes[editIndex].obs = obs;
    clientes[editIndex].site = site;
    document.getElementById("editIndex").value = "";
  } else {
    const senha = proximaSenha();
    if(!senha) return;
    clientes.unshift({nome, obs, site, senha});
  }

  atualizarTabela();
  document.getElementById("nome").value = "";
  document.getElementById("obs").value = "";
}

function atualizarTabela(){
  const tbody = document.getElementById("lista");
  tbody.innerHTML = "";
  clientes.forEach((c,i)=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td data-label="Nome">${c.nome}</td>
      <td data-label="Obs">${c.obs}</td>
      <td data-label="Site">${c.site}</td>
      <td data-label="Senha"><b>${c.senha}</b></td>
      <td data-label="A√ß√µes">
        <button class="btn-mini" onclick="compartilhar(${i})">Compartilhar</button>
        <button class="btn-mini btn-edit" onclick="editar(${i})">Editar</button>
        <button class="btn-mini btn-del" onclick="apagar(${i})">Excluir</button>
      </td>`;
    tbody.appendChild(tr);
  });
  salvarLocal();
}

function editar(i){
  const c = clientes[i];
  document.getElementById("nome").value = c.nome;
  document.getElementById("obs").value = c.obs;
  document.getElementById("site").value = c.site;
  document.getElementById("editIndex").value = i;
}

function apagar(i){
  if(confirm("Excluir cliente?")){
    const c = clientes[i];
    const idx = senhasUsadas.indexOf(c.senha);
    if(idx > -1) senhasUsadas.splice(idx, 1);
    clientes.splice(i,1);
    atualizarTabela();
  }
}

function compartilhar(i){
  const c = clientes[i];
  const msg = `üîë Senha de acesso\nüë§ Cliente: ${c.nome}\nüí¨ Obs: ${c.obs}\nüîê Senha: ${c.senha}`;
  window.open("https://wa.me/?text="+encodeURIComponent(msg), "_blank");
}

function filtrarTabela(){
  const termo = document.getElementById("pesquisa").value.toLowerCase();
  document.querySelectorAll("#lista tr").forEach(l=>{
    l.style.display = l.innerText.toLowerCase().includes(termo) ? "" : "none";
  });
}

function exportarDados(){
  const dados = {clientes, senhasUsadas};
  const blob = new Blob([JSON.stringify(dados,null,2)],{type:"application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url; a.download = "backup-senhas.json"; a.click();
  URL.revokeObjectURL(url);
}

function importarDados(event){
  const file = event.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload=function(e){
    try{
      const dados = JSON.parse(e.target.result);
      clientes = dados.clientes || [];
      if(Array.isArray(dados.senhasUsadas)){
        senhasUsadas = dados.senhasUsadas;
      } else if(dados.senhasUsadas && typeof dados.senhasUsadas === "object"){
        senhasUsadas = Object.values(dados.senhasUsadas).flat().filter(Boolean);
        senhasUsadas = [...new Set(senhasUsadas)];
      } else senhasUsadas=[];
      atualizarTabela();
      alert("Backup importado com sucesso!");
    } catch(err){ alert("Erro ao importar: "+err); }
  }
  reader.readAsText(file);
}

atualizarTabela();

if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js')
    .then(() => console.log('Service Worker registrado'))
    .catch(err => console.error('Erro ao registrar SW', err));
}
</script>
</body>
</html>
