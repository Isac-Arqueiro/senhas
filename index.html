<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Painel de Senhas</title>
<style>
body {
  font-family: 'Segoe UI', Arial, sans-serif;
  background: linear-gradient(135deg,#1e3c72,#2a5298);
  margin:0;padding:15px;color:#fff;
}
h1{text-align:center;margin-bottom:15px;font-size:1.6em;text-shadow:0 0 8px #000;}
.formulario{
  background:rgba(0,0,0,0.6);padding:15px;border-radius:10px;margin-bottom:15px;
  box-shadow:0 3px 8px rgba(0,0,0,0.4);
}
h2{margin-top:0;color:#ffcc00;text-align:center;font-size:1.1em;}
label{font-weight:bold;display:block;margin-top:8px;font-size:0.9em;}
input,select,textarea,button{
  margin-top:6px;padding:8px;width:100%;border-radius:6px;border:none;font-size:14px;box-sizing:border-box;
}
input,select,textarea{background:#f4f4f4;color:#333;}
button{background:#ffcc00;color:#333;font-weight:bold;cursor:pointer;transition:0.3s;margin-top:10px;}
button:hover{background:#ffdb4d;}
table{width:100%;border-collapse:collapse;margin-top:10px;font-size:12px;}
th,td{padding:6px;border:1px solid #444;text-align:center;}
th{background:#333;color:#ffcc00;}
td{background:rgba(255,255,255,0.1);}
td b{color:#00ffcc;}
.btn-mini{background:#00cc66;color:#fff;border:none;padding:4px 6px;border-radius:5px;cursor:pointer;font-size:11px;margin:1px;}
.btn-mini:hover{background:#00e676;}
.btn-del{background:#cc0000;}
.btn-del:hover{background:#ff3333;}
.btn-edit{background:#ff9900;}
.btn-edit:hover{background:#ffb84d;}
#pesquisa{margin-bottom:8px;padding:6px;width:100%;border-radius:6px;border:none;font-size:13px;background:#f4f4f4;color:#333;}

/* Mobile */
@media(max-width:600px){
  h1{font-size:1.4em;}
  table,thead,tbody,th,td,tr{display:block;}
  thead tr{display:none;}
  tr{margin-bottom:10px;border:1px solid #444;border-radius:6px;padding:5px;}
  td{border:none;padding:4px 0;text-align:right;position:relative;padding-left:50%;}
  td::before{content:attr(data-label);position:absolute;left:10px;width:45%;padding-left:5px;font-weight:bold;text-align:left;font-size:12px;}
}
</style>
</head>
<body>
<h1>üîê Painel de Senhas</h1>

<div class="formulario">
  <h2>‚ûï Cadastrar / Editar Cliente</h2>
  <label>Nome:</label><input type="text" id="nome">
  <label>Observa√ß√£o:</label><textarea id="obs"></textarea>
  <label>Site:</label>
  <select id="site">
    <option value="A">Site A</option>
    <option value="B">Site B</option>
    <option value="C">Site C</option>
    <option value="D">Site D</option>
  </select>
  <input type="hidden" id="editIndex">
  <button onclick="salvarCliente()">Salvar</button>
</div>

<div class="formulario">
  <h2>‚öôÔ∏è Redefinir Ponto de In√≠cio</h2>
  <input type="number" id="novoInicio" placeholder="Ex: 2578">
  <button onclick="definirPonto()">Atualizar</button>
</div>

<div class="formulario">
  <h2>üìã Clientes e Senhas</h2>
  <input type="text" id="pesquisa" placeholder="üîé Pesquisar..." onkeyup="filtrarTabela()">
  <table>
    <thead>
      <tr><th>Nome</th><th>Obs</th><th>Site</th><th>Senha</th><th>Status</th><th>A√ß√µes</th></tr>
    </thead>
    <tbody id="lista"></tbody>
  </table>
</div>

<div class="formulario">
  <h2>üíæ Backup</h2>
  <button onclick="exportarDados()">‚¨áÔ∏è Exportar JSON</button>
  <input type="file" id="importarArquivo" accept=".json" onchange="importarDados(event)">
</div>

<script>
let deviceId=localStorage.getItem("deviceId");
if(!deviceId){deviceId='dev-'+Math.random().toString(36).substr(2,9);localStorage.setItem("deviceId",deviceId);}

let baseNumeros=[];for(let i=2500;i<=2594;i++) baseNumeros.push("00"+i);
let originalPonto=parseInt(localStorage.getItem("pontoOriginal")||2500);
let pontoAtual=parseInt(localStorage.getItem("pontoAtual")||originalPonto);

let clientes=JSON.parse(localStorage.getItem("clientes")||"[]");
let senhasUsadas=JSON.parse(localStorage.getItem("senhasUsadas")||'{"A":[],"B":[],"C":[],"D":[]}');

function salvarLocal(){
  localStorage.setItem("clientes",JSON.stringify(clientes));
  localStorage.setItem("senhasUsadas",JSON.stringify(senhasUsadas));
  localStorage.setItem("pontoAtual",pontoAtual);
  localStorage.setItem("pontoOriginal",originalPonto);
}

function proximaSenha(site){
  for(let num of baseNumeros){
    const senha=site+num;
    if(!senhasUsadas[site].some(s=>s.senha===senha)){
      senhasUsadas[site].push({senha,device:deviceId});
      salvarLocal();return senha;
    }
  }return null;
}

function salvarCliente(){
  const nome=document.getElementById("nome").value.trim();
  const obs=document.getElementById("obs").value.trim();
  const site=document.getElementById("site").value;
  const editIndex=document.getElementById("editIndex").value;
  if(!nome){alert("Digite o nome!");return;}

  if(editIndex){
    clientes[editIndex].nome=nome;clientes[editIndex].obs=obs;clientes[editIndex].site=site;
    document.getElementById("editIndex").value="";
  }else{
    const senha=proximaSenha(site);
    if(!senha){alert("‚ö†Ô∏è Todas as senhas foram usadas!");return;}
    clientes.unshift({nome,obs,site,senha});
  }
  atualizarTabela();
  document.getElementById("nome").value="";document.getElementById("obs").value="";
}

function atualizarTabela(){
  const tbody=document.getElementById("lista");tbody.innerHTML="";
  clientes.forEach((c,i)=>{
    const usado=senhasUsadas[c.site].find(s=>s.senha===c.senha);
    const status=(usado && usado.device===deviceId)?"Neste dispositivo":"Outro dispositivo";
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td data-label="Nome">${c.nome}</td>
      <td data-label="Obs">${c.obs}</td>
      <td data-label="Site">${c.site}</td>
      <td data-label="Senha"><b>${c.senha}</b></td>
      <td data-label="Status">${status}</td>
      <td data-label="A√ß√µes">
        <button class="btn-mini" onclick="compartilhar(${i})">Compartilhar</button>
        <button class="btn-mini btn-edit" onclick="editar(${i})">Editar</button>
        <button class="btn-mini btn-del" onclick="apagar(${i})">Excluir</button>
      </td>`;
    tbody.appendChild(tr);
  });
  salvarLocal();
}

function editar(i){
  const c=clientes[i];
  document.getElementById("nome").value=c.nome;
  document.getElementById("obs").value=c.obs;
  document.getElementById("site").value=c.site;
  document.getElementById("editIndex").value=i;
}

function apagar(i){
  if(confirm("Excluir cliente?")){
    const c=clientes[i];
    const idx=senhasUsadas[c.site].findIndex(s=>s.senha===c.senha);
    if(idx>-1) senhasUsadas[c.site].splice(idx,1);
    clientes.splice(i,1);
    atualizarTabela();
  }
}

function filtrarTabela(){
  const termo=document.getElementById("pesquisa").value.toLowerCase();
  document.querySelectorAll("#lista tr").forEach(l=>{
    l.style.display=l.innerText.toLowerCase().includes(termo)?"":"none";
  });
}

function compartilhar(i){
  const c=clientes[i];
  const msg=`üîë Senha de acesso\nüë§ Cliente: ${c.nome}\nüí¨ Obs: ${c.obs}\nüîê Senha: ${c.senha}\nüìÖ V√°lida at√©: 31/12`;
  window.open("https://wa.me/?text="+encodeURIComponent(msg),"_blank");
}

function definirPonto(){
  const novo=parseInt(document.getElementById("novoInicio").value);
  if(!novo){alert("Digite um n√∫mero v√°lido!");return;}
  pontoAtual=novo;baseNumeros=[];for(let i=novo;i<=2594;i++) baseNumeros.push("00"+i);
  salvarLocal();alert("Ponto de in√≠cio atualizado!");
}

function exportarDados(){
  const dados={clientes,senhasUsadas,pontoAtual,originalPonto};
  const blob=new Blob([JSON.stringify(dados,null,2)],{type:"application/json"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url;a.download="backup-senhas.json";a.click();
  URL.revokeObjectURL(url);
}

function importarDados(event){
  const file=event.target.files[0];
  if(!file) return;
  const reader=new FileReader();
  reader.onload=function(e){
    try{
      const dados=JSON.parse(e.target.result);
      clientes=dados.clientes||[];
      senhasUsadas=dados.senhasUsadas||{"A":[],"B":[],"C":[],"D":[]};
      pontoAtual=dados.pontoAtual||2500;
      originalPonto=dados.originalPonto||2500;
      atualizarTabela();
      alert("Backup importado com sucesso!");
    }catch(err){alert("Erro ao importar: "+err);}
  }
  reader.readAsText(file);
}

// inicializar
atualizarTabela();
</script>
</body>
</html>
